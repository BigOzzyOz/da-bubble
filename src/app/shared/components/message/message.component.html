<main [class.self]="isAuthorCurrentUser" [class.edit]="postEdit">
  @if (!threadHead) {

    @if (!postEdit) {
      <section 
        class="reaction-bar" 
        [ngStyle]="{
          'right': isAuthorCurrentUser ? 'unset' : '40.06px',
          'left': isAuthorCurrentUser ? '40.06px' : 'unset'
        }">

        <div class="reaction-bar-icon" (click)="emojiSelector.addEmojiToReaction(getLastEmoji())">
          <p class="emoji">{{getLastEmoji().emoji.native}}</p>
        </div>

        <div class="reaction-bar-icon" (click)="emojiSelector.addEmojiToReaction(getMostRecentEmoji())">
          <p class="emoji" [innerHTML]="getMostRecentEmoji().emoji.native"></p>
        </div>

        <div class="reaction-bar-icon add-reaction reaction-bar-icon-special"
          (click)="showEmojiSelector = !showEmojiSelector">
          <div>
            <svg width="23" height="21" viewBox="0 0 23 21" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M10.9365 21C9.55319 21 8.25319 20.7375 7.03652 20.2125C5.81986 19.6875 4.76152 18.975 3.86152 18.075C2.96152 17.175 2.24902 16.1167 1.72402 14.9C1.19902 13.6833 0.936523 12.3833 0.936523 11C0.936523 9.61667 1.19902 8.31667 1.72402 7.1C2.24902 5.88333 2.96152 4.825 3.86152 3.925C4.76152 3.025 5.81986 2.3125 7.03652 1.7875C8.25319 1.2625 9.55319 1 10.9365 1C11.6865 1 12.4157 1.07917 13.124 1.2375C13.8324 1.39583 14.5032 1.625 15.1365 1.925C15.0699 2.09167 15.0199 2.26667 14.9865 2.45C14.9532 2.63333 14.9365 2.81667 14.9365 3C14.9365 3.23333 14.9615 3.45417 15.0115 3.6625C15.0615 3.87083 15.1282 4.06667 15.2115 4.25C14.5949 3.86667 13.9282 3.5625 13.2115 3.3375C12.4949 3.1125 11.7365 3 10.9365 3C8.71986 3 6.83236 3.77917 5.27402 5.3375C3.71569 6.89583 2.93652 8.78333 2.93652 11C2.93652 13.2167 3.71569 15.1042 5.27402 16.6625C6.83236 18.2208 8.71986 19 10.9365 19C13.1532 19 15.0407 18.2208 16.599 16.6625C18.1574 15.1042 18.9365 13.2167 18.9365 11C18.9365 10.3333 18.8574 9.69167 18.699 9.075C18.5407 8.45833 18.3199 7.875 18.0365 7.325C18.3032 7.54167 18.5949 7.70833 18.9115 7.825C19.2282 7.94167 19.5699 8 19.9365 8C20.0199 8 20.1074 7.99583 20.199 7.9875C20.2907 7.97917 20.3782 7.96667 20.4615 7.95C20.6115 8.43333 20.7282 8.92917 20.8115 9.4375C20.8949 9.94583 20.9365 10.4667 20.9365 11C20.9365 12.3833 20.674 13.6833 20.149 14.9C19.624 16.1167 18.9115 17.175 18.0115 18.075C17.1115 18.975 16.0532 19.6875 14.8365 20.2125C13.6199 20.7375 12.3199 21 10.9365 21ZM14.4365 10C14.8699 10 15.2282 9.85833 15.5115 9.575C15.7949 9.29167 15.9365 8.93333 15.9365 8.5C15.9365 8.06667 15.7949 7.70833 15.5115 7.425C15.2282 7.14167 14.8699 7 14.4365 7C14.0032 7 13.6449 7.14167 13.3615 7.425C13.0782 7.70833 12.9365 8.06667 12.9365 8.5C12.9365 8.93333 13.0782 9.29167 13.3615 9.575C13.6449 9.85833 14.0032 10 14.4365 10ZM7.43652 10C7.86986 10 8.22819 9.85833 8.51152 9.575C8.79486 9.29167 8.93652 8.93333 8.93652 8.5C8.93652 8.06667 8.79486 7.70833 8.51152 7.425C8.22819 7.14167 7.86986 7 7.43652 7C7.00319 7 6.64486 7.14167 6.36152 7.425C6.07819 7.70833 5.93652 8.06667 5.93652 8.5C5.93652 8.93333 6.07819 9.29167 6.36152 9.575C6.64486 9.85833 7.00319 10 7.43652 10ZM10.9365 16.5C12.1199 16.5 13.1657 16.175 14.074 15.525C14.9824 14.875 15.6365 14.0333 16.0365 13H5.83652C6.23652 14.0333 6.89069 14.875 7.79902 15.525C8.70736 16.175 9.75319 16.5 10.9365 16.5ZM18.9365 4H17.9365C17.6532 4 17.4157 3.90417 17.224 3.7125C17.0324 3.52083 16.9365 3.28333 16.9365 3C16.9365 2.71667 17.0324 2.47917 17.224 2.2875C17.4157 2.09583 17.6532 2 17.9365 2H18.9365V1C18.9365 0.716667 19.0324 0.479167 19.224 0.2875C19.4157 0.0958333 19.6532 0 19.9365 0C20.2199 0 20.4574 0.0958333 20.649 0.2875C20.8407 0.479167 20.9365 0.716667 20.9365 1V2H21.9365C22.2199 2 22.4574 2.09583 22.649 2.2875C22.8407 2.47917 22.9365 2.71667 22.9365 3C22.9365 3.28333 22.8407 3.52083 22.649 3.7125C22.4574 3.90417 22.2199 4 21.9365 4H20.9365V5C20.9365 5.28333 20.8407 5.52083 20.649 5.7125C20.4574 5.90417 20.2199 6 19.9365 6C19.6532 6 19.4157 5.90417 19.224 5.7125C19.0324 5.52083 18.9365 5.28333 18.9365 5V4Z"
                fill="black" />
            </svg>
          </div>
        </div>

        @if (!isThread ) {
          <div class="reaction-bar-icon answer reaction-bar-icon-special" (click)="openThread(post.id)">
            <div>
              <svg width="21" height="19" viewBox="0 0 21 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M5.93652 12H15.9365C16.2199 12 16.4572 11.904 16.6485 11.712C16.8405 11.5207 16.9365 11.2833 16.9365 11C16.9365 10.7167 16.8405 10.479 16.6485 10.287C16.4572 10.0957 16.2199 10 15.9365 10H5.93652C5.65319 10 5.41552 10.0957 5.22352 10.287C5.03219 10.479 4.93652 10.7167 4.93652 11C4.93652 11.2833 5.03219 11.5207 5.22352 11.712C5.41552 11.904 5.65319 12 5.93652 12ZM5.93652 9H15.9365C16.2199 9 16.4572 8.904 16.6485 8.712C16.8405 8.52067 16.9365 8.28333 16.9365 8C16.9365 7.71667 16.8405 7.479 16.6485 7.287C16.4572 7.09567 16.2199 7 15.9365 7H5.93652C5.65319 7 5.41552 7.09567 5.22352 7.287C5.03219 7.479 4.93652 7.71667 4.93652 8C4.93652 8.28333 5.03219 8.52067 5.22352 8.712C5.41552 8.904 5.65319 9 5.93652 9ZM5.93652 6H15.9365C16.2199 6 16.4572 5.90433 16.6485 5.713C16.8405 5.521 16.9365 5.28333 16.9365 5C16.9365 4.71667 16.8405 4.479 16.6485 4.287C16.4572 4.09567 16.2199 4 15.9365 4H5.93652C5.65319 4 5.41552 4.09567 5.22352 4.287C5.03219 4.479 4.93652 4.71667 4.93652 5C4.93652 5.28333 5.03219 5.521 5.22352 5.713C5.41552 5.90433 5.65319 6 5.93652 6ZM19.2365 18.3L16.9365 16H2.93652C2.38652 16 1.91586 15.8043 1.52452 15.413C1.13252 15.021 0.936523 14.55 0.936523 14V2C0.936523 1.45 1.13252 0.979 1.52452 0.587C1.91586 0.195667 2.38652 0 2.93652 0H18.9365C19.4865 0 19.9575 0.195667 20.3495 0.587C20.7409 0.979 20.9365 1.45 20.9365 2V17.575C20.9365 18.025 20.7325 18.3373 20.3245 18.512C19.9159 18.6873 19.5532 18.6167 19.2365 18.3ZM2.93652 2V14H17.7615L18.9365 15.175V2H2.93652Z"
                  fill="black" />
              </svg>
            </div>
          </div>
        }

        <div class="reaction-bar-icon more reaction-bar-icon-special"
          [ngStyle]="{'display': isAuthorCurrentUser ? 'flex' : 'none'}">
          <div (click)="isSpecialMenuOpen = !isSpecialMenuOpen">
            <svg width="4" height="16" viewBox="0 0 4 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M2 16C1.45 16 0.979167 15.8042 0.5875 15.4125C0.195833 15.0208 0 14.55 0 14C0 13.45 0.195833 12.9792 0.5875 12.5875C0.979167 12.1958 1.45 12 2 12C2.55 12 3.02083 12.1958 3.4125 12.5875C3.80417 12.9792 4 13.45 4 14C4 14.55 3.80417 15.0208 3.4125 15.4125C3.02083 15.8042 2.55 16 2 16ZM2 10C1.45 10 0.979167 9.80417 0.5875 9.4125C0.195833 9.02083 0 8.55 0 8C0 7.45 0.195833 6.97917 0.5875 6.5875C0.979167 6.19583 1.45 6 2 6C2.55 6 3.02083 6.19583 3.4125 6.5875C3.80417 6.97917 4 7.45 4 8C4 8.55 3.80417 9.02083 3.4125 9.4125C3.02083 9.80417 2.55 10 2 10ZM2 4C1.45 4 0.979167 3.80417 0.5875 3.4125C0.195833 3.02083 0 2.55 0 2C0 1.45 0.195833 0.979167 0.5875 0.5875C0.979167 0.195833 1.45 0 2 0C2.55 0 3.02083 0.195833 3.4125 0.5875C3.80417 0.979167 4 1.45 4 2C4 2.55 3.80417 3.02083 3.4125 3.4125C3.02083 3.80417 2.55 4 2 4Z"
                fill="#1C1B1F" />
            </svg>
          </div>
          <div class="special-container" [class.active]="isSpecialMenuOpen">
            <p (click)="editPost()">Nachricht bearbeiten</p>
          </div>
        </div>

      </section>
    }
  }

  <section class="avatar">
    <img
      [src]="authorAvatar.startsWith('profile-') ? 'assets/img/profile-pictures/' + authorAvatar : cloud.openImage(authorAvatar)"
      alt="avatar">
  </section>


  <section class="message-section" [class.self]="isAuthorCurrentUser">

    <div class="author-section" [class.self]="isAuthorCurrentUser">
      <div class="author" [innerHTML]="authorName"></div>
      <div class="post-time" [innerHTML]="postTime(post.timestamp) + ' Uhr'"></div>
    </div>

    @if(postEdit) {

      <app-inputfield id="editMessage" [thread]="isThread" [(edit)]="postEdit" [post]="post"></app-inputfield>
     
    }
    @else {
      <div class="message" [class.self]="isAuthorCurrentUser" [innerHTML]="getText(post.text)"></div>
    }

    @if (post.emoticons && post.emoticons.length > 0 && !threadHead) {
      <div class="emoticons-container">
        @for (emoticon of post.emoticons; track $index) {
          <div class="emoticon"
            (click)="emojiSelector.addEmojiToReaction({'emoji': {'native': emoticon.type, 'origin': origin, 'isThread': isThread, 'post': post, 'isInput': false}})">
            <h4 class="emoticon-type" [innerHTML]="emoticon.type"></h4>
            <p class="emoticon-count" [innerHTML]="emoticon.count"></p>
            <div class="emoticon-names-container">
              <h4 class="emoticon-type" [innerHTML]="emoticon.type"></h4>
              @for (emoticonName of emoticon.name; track $index) {
                <p class="emoticon-name" [innerHTML]="filterEmoticonNameArray(emoticon.name, $index)"></p>
              }
              <span class="emoticon-name-end"
                [innerHTML]="emoticon.name.length === 1 ? emoticon.name[0] === storage.currentUser.id ? 'hast reagiert' : 'hat reagiert' : 'haben reagiert'"></span>
            </div>
          </div>
        }
        <div class="emoticon-add-reaction" (click)="showEmojiSelector = !showEmojiSelector">
          <div>
            <svg width="23" height="21" viewBox="0 0 23 21" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M10.9365 21C9.55319 21 8.25319 20.7375 7.03652 20.2125C5.81986 19.6875 4.76152 18.975 3.86152 18.075C2.96152 17.175 2.24902 16.1167 1.72402 14.9C1.19902 13.6833 0.936523 12.3833 0.936523 11C0.936523 9.61667 1.19902 8.31667 1.72402 7.1C2.24902 5.88333 2.96152 4.825 3.86152 3.925C4.76152 3.025 5.81986 2.3125 7.03652 1.7875C8.25319 1.2625 9.55319 1 10.9365 1C11.6865 1 12.4157 1.07917 13.124 1.2375C13.8324 1.39583 14.5032 1.625 15.1365 1.925C15.0699 2.09167 15.0199 2.26667 14.9865 2.45C14.9532 2.63333 14.9365 2.81667 14.9365 3C14.9365 3.23333 14.9615 3.45417 15.0115 3.6625C15.0615 3.87083 15.1282 4.06667 15.2115 4.25C14.5949 3.86667 13.9282 3.5625 13.2115 3.3375C12.4949 3.1125 11.7365 3 10.9365 3C8.71986 3 6.83236 3.77917 5.27402 5.3375C3.71569 6.89583 2.93652 8.78333 2.93652 11C2.93652 13.2167 3.71569 15.1042 5.27402 16.6625C6.83236 18.2208 8.71986 19 10.9365 19C13.1532 19 15.0407 18.2208 16.599 16.6625C18.1574 15.1042 18.9365 13.2167 18.9365 11C18.9365 10.3333 18.8574 9.69167 18.699 9.075C18.5407 8.45833 18.3199 7.875 18.0365 7.325C18.3032 7.54167 18.5949 7.70833 18.9115 7.825C19.2282 7.94167 19.5699 8 19.9365 8C20.0199 8 20.1074 7.99583 20.199 7.9875C20.2907 7.97917 20.3782 7.96667 20.4615 7.95C20.6115 8.43333 20.7282 8.92917 20.8115 9.4375C20.8949 9.94583 20.9365 10.4667 20.9365 11C20.9365 12.3833 20.674 13.6833 20.149 14.9C19.624 16.1167 18.9115 17.175 18.0115 18.075C17.1115 18.975 16.0532 19.6875 14.8365 20.2125C13.6199 20.7375 12.3199 21 10.9365 21ZM14.4365 10C14.8699 10 15.2282 9.85833 15.5115 9.575C15.7949 9.29167 15.9365 8.93333 15.9365 8.5C15.9365 8.06667 15.7949 7.70833 15.5115 7.425C15.2282 7.14167 14.8699 7 14.4365 7C14.0032 7 13.6449 7.14167 13.3615 7.425C13.0782 7.70833 12.9365 8.06667 12.9365 8.5C12.9365 8.93333 13.0782 9.29167 13.3615 9.575C13.6449 9.85833 14.0032 10 14.4365 10ZM7.43652 10C7.86986 10 8.22819 9.85833 8.51152 9.575C8.79486 9.29167 8.93652 8.93333 8.93652 8.5C8.93652 8.06667 8.79486 7.70833 8.51152 7.425C8.22819 7.14167 7.86986 7 7.43652 7C7.00319 7 6.64486 7.14167 6.36152 7.425C6.07819 7.70833 5.93652 8.06667 5.93652 8.5C5.93652 8.93333 6.07819 9.29167 6.36152 9.575C6.64486 9.85833 7.00319 10 7.43652 10ZM10.9365 16.5C12.1199 16.5 13.1657 16.175 14.074 15.525C14.9824 14.875 15.6365 14.0333 16.0365 13H5.83652C6.23652 14.0333 6.89069 14.875 7.79902 15.525C8.70736 16.175 9.75319 16.5 10.9365 16.5ZM18.9365 4H17.9365C17.6532 4 17.4157 3.90417 17.224 3.7125C17.0324 3.52083 16.9365 3.28333 16.9365 3C16.9365 2.71667 17.0324 2.47917 17.224 2.2875C17.4157 2.09583 17.6532 2 17.9365 2H18.9365V1C18.9365 0.716667 19.0324 0.479167 19.224 0.2875C19.4157 0.0958333 19.6532 0 19.9365 0C20.2199 0 20.4574 0.0958333 20.649 0.2875C20.8407 0.479167 20.9365 0.716667 20.9365 1V2H21.9365C22.2199 2 22.4574 2.09583 22.649 2.2875C22.8407 2.47917 22.9365 2.71667 22.9365 3C22.9365 3.28333 22.8407 3.52083 22.649 3.7125C22.4574 3.90417 22.2199 4 21.9365 4H20.9365V5C20.9365 5.28333 20.8407 5.52083 20.649 5.7125C20.4574 5.90417 20.2199 6 19.9365 6C19.6532 6 19.4157 5.90417 19.224 5.7125C19.0324 5.52083 18.9365 5.28333 18.9365 5V4Z"
                fill="black" />
            </svg>
          </div>
        </div>
      </div>
    }


    @if (post.thread && !threadHead) {
      <div class="answer-section" [class.self]="isAuthorCurrentUser">
        <div class="answers" (click)="handleClick(post.id)"
          [innerHTML]="post.threadMsg?.length + (post.threadMsg?.length === 1 ? ' Antwort' : ' Antworten')"></div>
        <div class="post-time" [innerHTML]="'Letzte Antwort ' + lastThreadMsgTime()"></div>
      </div>
    }
  </section>
</main>

@if (threadHead) {
  <div class="thread-start">
    @if (post.thread) {
      <div class="threadAnswers"
        [innerHTML]="post.threadMsg?.length + (post.threadMsg?.length === 1 ? ' Antwort' : ' Antworten')"></div>
    }
    <div class="oLine"></div>
  </div>
}


<div class="smileys-container" [class.active]="showEmojiSelector" (click)="outsideClick($event)">
  <app-emoji-selector [origin]="origin" [isThread]="isThread" [post]="post" [isInput]="false"></app-emoji-selector>
</div>